# 披萨订购系统 API

一个基于 Node.js 和 Express 构建的 RESTful API，用于管理披萨订购系统。该系统支持客户管理、披萨菜单管理和订单处理功能。

## 功能特性

- **客户管理**: 创建、查看、更新和删除客户信息
- **披萨菜单**: 管理披萨产品，包括名称、描述、价格和尺寸
- **订单处理**: 创建订单、更新订单状态、查看订单历史
- **数据验证**: 完整的输入验证和错误处理
- **RESTful API**: 符合 REST 设计原则的 API 接口
- **SQLite 数据库**: 轻量级数据库，适合开发和测试

## 技术栈

- **后端框架**: Node.js + Express.js
- **数据库**: SQLite3
- **依赖管理**: npm
- **开发工具**: nodemon (开发环境)

## 安装和运行

### 环境要求

- Node.js (v14.0.0 或更高版本)
- npm (v6.0.0 或更高版本)

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <项目地址>
   cd hw_pizza_ordering_api
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **启动服务器**
   
   开发环境（使用 nodemon）：
   ```bash
   npx nodemon server.js
   ```
   
   生产环境：
   ```bash
   node server.js
   ```

4. **访问 API**
   
   服务器启动后，可以通过以下地址访问：
   - 基础 URL: `http://localhost:3000`
   - API 文档: `http://localhost:3000/`
   - 健康检查: `http://localhost:3000/health`

## API 文档

### 基础信息

- **基础 URL**: `http://localhost:3000/api`
- **数据格式**: JSON
- **字符编码**: UTF-8

### 端点概览

| 资源 | 端点 | 描述 |
|------|------|------|
| 客户 | `/api/customers` | 客户管理 |
| 披萨 | `/api/pizzas` | 披萨菜单管理 |
| 订单 | `/api/orders` | 订单处理 |

### 客户管理 API

#### 创建客户
```http
POST /api/customers
```

**请求体**:
```json
{
  "name": "张三",
  "email": "zhangsan@example.com",
  "phone": "13800138000",
  "address": "北京市朝阳区"
}
```

**响应**:
```json
{
  "message": "客户创建成功",
  "customer": {
    "customer_id": 1,
    "name": "张三",
    "email": "zhangsan@example.com",
    "phone": "13800138000",
    "address": "北京市朝阳区"
  }
}
```

#### 获取所有客户
```http
GET /api/customers
```

**响应**:
```json
{
  "count": 2,
  "customers": [
    {
      "customer_id": 1,
      "name": "张三",
      "email": "zhangsan@example.com",
      "phone": "13800138000",
      "address": "北京市朝阳区",
      "created_at": "2024-01-01 10:00:00"
    }
  ]
}
```

#### 获取单个客户
```http
GET /api/customers/:id
```

#### 更新客户信息
```http
PUT /api/customers/:id
```

#### 删除客户
```http
DELETE /api/customers/:id
```

### 披萨管理 API

#### 创建披萨
```http
POST /api/pizzas
```

**请求体**:
```json
{
  "name": "玛格丽特",
  "description": "经典玛格丽特披萨，配新鲜番茄、马苏里拉奶酪和罗勒",
  "price": 12.99,
  "size": "中"
}
```

**响应**:
```json
{
  "message": "披萨创建成功",
  "pizza": {
    "pizza_id": 1,
    "name": "玛格丽特",
    "description": "经典玛格丽特披萨，配新鲜番茄、马苏里拉奶酪和罗勒",
    "price": 12.99,
    "size": "中"
  }
}
```

#### 获取所有披萨
```http
GET /api/pizzas
```

#### 获取单个披萨
```http
GET /api/pizzas/:id
```

#### 更新披萨信息
```http
PUT /api/pizzas/:id
```

#### 删除披萨
```http
DELETE /api/pizzas/:id
```

### 订单管理 API

#### 创建订单
```http
POST /api/orders
```

**请求体**:
```json
{
  "customer_id": 1,
  "pizza_id": 1,
  "quantity": 2
}
```

**响应**:
```json
{
  "message": "订单创建成功",
  "order": {
    "order_id": 1,
    "customer_id": 1,
    "pizza_id": 1,
    "quantity": 2,
    "total_price": 25.98,
    "status": "Pending",
    "order_date": "2024-01-01 10:30:00",
    "customer_name": "张三",
    "email": "zhangsan@example.com",
    "phone": "13800138000",
    "address": "北京市朝阳区",
    "pizza_name": "玛格丽特",
    "description": "经典玛格丽特披萨，配新鲜番茄、马苏里拉奶酪和罗勒",
    "size": "中"
  }
}
```

#### 获取所有订单
```http
GET /api/orders
```

#### 获取单个订单
```http
GET /api/orders/:id
```

#### 获取客户的所有订单
```http
GET /api/orders/customer/:customer_id
```

#### 更新订单状态
```http
PUT /api/orders/:id/status
```

**请求体**:
```json
{
  "status": "Preparing"
}
```

**有效状态**: `Pending`, `Preparing`, `Out for Delivery`, `Delivered`, `Cancelled`

#### 删除订单
```http
DELETE /api/orders/:id
```

## 数据库结构

### 数据表设计

#### customers (客户表)
| 字段 | 类型 | 描述 |
|------|------|------|
| customer_id | INTEGER | 主键，自增 |
| name | TEXT | 客户姓名 |
| email | TEXT | 邮箱地址 (唯一) |
| phone | TEXT | 电话号码 |
| address | TEXT | 地址 |
| created_at | DATETIME | 创建时间 |

#### pizzas (披萨表)
| 字段 | 类型 | 描述 |
|------|------|------|
| pizza_id | INTEGER | 主键，自增 |
| name | TEXT | 披萨名称 |
| description | TEXT | 描述 |
| price | REAL | 价格 |
| size | TEXT | 尺寸 (小/中/大) |
| created_at | DATETIME | 创建时间 |

#### orders (订单表)
| 字段 | 类型 | 描述 |
|------|------|------|
| order_id | INTEGER | 主键，自增 |
| customer_id | INTEGER | 客户ID (外键) |
| pizza_id | INTEGER | 披萨ID (外键) |
| quantity | INTEGER | 数量 |
| total_price | REAL | 总价 |
| status | TEXT | 订单状态 |
| order_date | DATETIME | 订单日期 |
| created_at | DATETIME | 创建时间 |

### 数据库索引

- `idx_customers_email`: 客户邮箱索引
- `idx_orders_customer_id`: 订单客户ID索引
- `idx_orders_pizza_id`: 订单披萨ID索引
- `idx_orders_status`: 订单状态索引
- `idx_orders_order_date`: 订单日期索引

## 示例数据

系统启动时会自动插入以下示例披萨数据：

| 名称 | 描述 | 价格 | 尺寸 |
|------|------|------|------|
| 玛格丽特 | 经典玛格丽特披萨，配新鲜番茄、马苏里拉奶酪和罗勒 | ¥12.99 | 中 |
| 意大利辣香肠 | 香辣意大利辣香肠配马苏里拉奶酪 | ¥14.99 | 中 |
| 四季披萨 | 四种口味组合：蘑菇、火腿、朝鲜蓟和橄榄 | ¥16.99 | 中 |
| 海鲜披萨 | 新鲜海鲜搭配特制酱料 | ¥18.99 | 中 |
| 素食披萨 | 多种新鲜蔬菜搭配 | ¥13.99 | 中 |

## 开发指南

### 项目结构
